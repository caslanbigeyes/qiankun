# 🧪 微前端难点验证指南

## 快速启动

```bash
# 在项目根目录执行
./start-all.sh
```

等待所有应用启动后，访问：http://localhost:3000

---

## 难点一：依赖版本冲突

### 验证步骤
1. 打开浏览器控制台（F12）
2. 切换到 React 18 子应用
3. 切换到 React 17 子应用
4. 观察控制台日志

### 预期结果
✅ 两个子应用都能正常加载
✅ 控制台显示 `[React XX 子应用] mount`
✅ 没有报错或冲突

### 技术要点
- 每个子应用都有独立的 `library` 命名
- UMD 打包格式避免全局变量污染
- webpack `chunkLoadingGlobal` 独立配置

---

## 难点二：全局状态同步

### 验证步骤
1. 在主应用点击"模拟登录"按钮
2. 观察主应用显示"欢迎，李四 (user)"
3. 切换到 React 18 子应用
4. 查看"登录状态同步"区域，应显示用户信息
5. 切换到 React 17 子应用
6. 同样能看到用户信息
7. 回到主应用点击"登出"
8. 再次查看子应用，状态已更新为未登录

### 预期结果
✅ 主应用登录后，子应用实时接收状态
✅ 子应用显示完整的用户信息（姓名、角色、token）
✅ 登出后子应用状态同步更新
✅ 消息记录中显示具体的通知信息

### 技术要点
- 使用 `BroadcastChannel` API
- 主应用发送消息：`channel.postMessage({ type: 'LOGIN', user })`
- 子应用监听：`channel.onmessage = (e) => { ... }`
- 支持多标签页同步

---

## 难点三：样式隔离

### 验证步骤
1. 打开浏览器开发者工具（F12）
2. 切换到 Elements/元素 标签
3. 检查主应用的样式
4. 切换到 React 18 子应用
5. 检查子应用的样式标签
6. 观察是否有 `data-qiankun-xxx` 属性

### 预期结果
✅ 子应用的样式标签有特殊标记
✅ React 18 子应用背景色为蓝色系（#e6f7ff）
✅ React 17 子应用背景色为橙色系（#fff7e6）
✅ 切换应用时样式不会相互污染

### 技术要点
- qiankun 配置：`experimentalStyleIsolation: true`
- 每个子应用的样式自动添加前缀
- 主应用样式不影响子应用

---

## 难点四：性能优化（预加载）

### 验证步骤
1. 打开浏览器开发者工具（F12）
2. 切换到 Network/网络 标签
3. 刷新页面（主应用）
4. 观察网络请求
5. 切换到 React 18 子应用
6. 观察是否还有新的 JS 请求

### 预期结果
✅ 主应用加载时，子应用资源已开始预加载
✅ 切换到子应用时，资源基本已缓存
✅ 子应用切换速度快，几乎无白屏

### 技术要点
- qiankun 配置：`prefetch: true`
- 主应用空闲时自动预加载子应用资源
- 浏览器 HTTP 缓存机制

---

## 难点五：子应用通信

### 验证步骤
1. 切换到 React 18 子应用
2. 点击"发送消息到 React 17"按钮
3. 观察 React 18 的消息记录，应显示"发送消息到 React17: Hello from React 18!"
4. 切换到 React 17 子应用
5. 查看消息记录，应显示"收到 React18 消息: Hello from React 18!"
6. 点击"发送消息到 React 18"按钮
7. 切换回 React 18 子应用
8. 查看消息记录，应显示来自 React 17 的消息

### 预期结果
✅ 子应用 A 发送的消息，子应用 B 能接收
✅ 消息记录显示完整的时间戳和内容
✅ 双向通信都正常工作

### 技术要点
- 全局 EventBus 实现：`window.eventBus`
- 发布：`window.eventBus.emit('event', data)`
- 订阅：`window.eventBus.on('event', callback)`
- 解耦的消息传递机制

---

## 🎯 验证清单

完成以下所有项即表示验证成功：

- [ ] ✅ 依赖版本冲突：两个子应用都能正常运行
- [ ] ✅ 全局状态同步：登录/登出状态实时同步
- [ ] ✅ 样式隔离：不同子应用样式互不影响
- [ ] ✅ 性能优化：预加载生效，切换流畅
- [ ] ✅ 子应用通信：消息双向传递成功

---

## 🐛 常见问题排查

### 子应用加载 404
**原因**：子应用未启动或端口错误  
**解决**：确保三个应用都在运行（端口 3000、3001、3002）

### BroadcastChannel 不工作
**原因**：浏览器不支持或协议不一致  
**解决**：使用 Chrome/Edge 最新版，确保都是 http://localhost

### 样式未隔离
**原因**：qiankun 配置未生效  
**解决**：检查 `main-app/src/micro-app.js` 中的 `experimentalStyleIsolation` 配置

### EventBus 通信失败
**原因**：EventBus 未初始化  
**解决**：确保主应用中 `window.eventBus` 已定义

### 预加载未生效
**原因**：qiankun 配置问题  
**解决**：检查 `prefetch: true` 配置，清除浏览器缓存重试

---

## 📊 性能指标参考

| 指标 | 预期值 |
|------|--------|
| 主应用首屏加载 | < 2s |
| 子应用首次切换 | < 1s |
| 子应用二次切换 | < 300ms |
| 状态同步延迟 | < 100ms |
| 消息传递延迟 | < 50ms |

---

**验证愉快！如有问题请查看控制台日志或 README.md** 🎉
